services:
  zenoh-router:
    image: eclipse/zenoh:latest
    container_name: fendtastic-zenoh-router
    ports:
      - "7447:7447"
      - "8000:8000"
    volumes:
      - ./config/zenoh-router.json5:/etc/zenoh/config.json5
    command: -c /etc/zenoh/config.json5

  eva-ics:
    image: bmauto/eva-ics4:latest
    container_name: fendtastic-eva-ics
    ports:
      - "7727:7727"
      - "4840:4840"
    volumes:
      - eva-ics-data:/opt/eva4/runtime
    environment:
      - EVA_ICS_API_KEY=${EVA_ICS_API_KEY}
    restart: unless-stopped

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: fendtastic-backend
    ports:
      - "8080:8080"
    environment:
      - ZENOH_ROUTER=tcp/zenoh-router:7447
      - EVA_ICS_URL=http://eva-ics:7727
      - EVA_ICS_API_KEY=${EVA_ICS_API_KEY}
      - PEA_CONFIG_DIR=/app/data/pea-configs
    depends_on:
      - zenoh-router
      - eva-ics
    volumes:
      - ./config:/app/config
      - pea-configs:/app/data/pea-configs

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: fendtastic-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend

volumes:
  eva-ics-data:
  pea-configs:
